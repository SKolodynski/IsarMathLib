<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory FiniteSeq_ZF</title>
</head>


<body>
<div class="head">
<h1>Theory FiniteSeq_ZF</h1>
</div>

<pre class="source"><span class="comment1">(*
    This file is a part of IsarMathLib - 
    a library of formalized mathematics for Isabelle/Isar.

    Copyright (C) 2007  Slawomir Kolodynski

    This program is free software Redistribution and use in source and binary forms, 
    with or without modification, are permitted provided that the following conditions are met:

   1. Redistributions of source code must retain the above copyright notice, 
   this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright notice, 
   this list of conditions and the following disclaimer in the documentation and/or 
   other materials provided with the distribution.
   3. The name of the author may not be used to endorse or promote products 
   derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED 
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF 
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES LOSS OF USE, DATA, OR PROFITS 
OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, 
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR 
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, 
EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Finite sequences›</span></span>

<span class="keyword1"><span class="command">theory</span></span> FiniteSeq_ZF <span class="keyword2"><span class="keyword">imports</span></span> <a href="Nat_ZF_IML.html">Nat_ZF_IML</a> <a href="func1.html">func1</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This theory treats finite sequences (i.e. maps $n\rightarrow X$, where
  $n=\{0,1,..,n-1\}$ is a natural number) as lists. It defines and proves
  the properties of basic operations on lists: concatenation, appending
  and element etc.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lists as finite sequences›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A natural way of representing (finite) lists in set theory is through 
  (finite) sequences.
  In such view a list of elements of a set $X$ is a 
  function that maps the set $\{0,1,..n-1\}$ into $X$. Since natural numbers 
  in set theory are defined so that $n =\{0,1,..n-1\}$, a list of length $n$
  can be understood as an element of the function space $n\rightarrow X$.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define the set of lists with values in set $X$ as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Lists(X)›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Lists</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>nat<span class="main">.</span><span class="main">(</span><span class="bound">n</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The set of nonempty $X$-value listst will be called <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>NELists(X)›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NELists</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">⋃</span><span class="bound">n</span><span class="main">∈</span>nat<span class="main">.</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">n</span><span class="main">)</span><span class="main">→</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We first define the shift that moves the second sequence
  to the domain $\{n,..,n+k-1\}$, where $n,k$ are the lengths of the first 
  and the second sequence, resp.  
  To understand the notation in the definitions below recall that in Isabelle/ZF 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>pred(n)›</span></span></span></span> is the previous natural number and  
   denotes the difference between natural numbers $n$ and $k$.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ShiftedSeq</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">j</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">`</span><span class="main">(</span><span class="bound">j</span> <span class="main">#-</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">,</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define concatenation of two sequences as the union of the first sequence 
  with the shifted second sequence. The result of concatenating lists 
  $a$ and $b$ is called <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Concat(a,b)›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Concat</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> ShiftedSeq<span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">,</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For a finite sequence we define the sequence of all elements 
  except the first one. This corresponds to the "tail" function in Haskell.
  We call it <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Tail›</span></span></span></span> here as well.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>  
  <span class="quoted"><span class="quoted">"<span class="free">Tail</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> pred<span class="main">(</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A dual notion to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Tail›</span></span></span></span> is the list
  of all elements of a list except the last one. Borrowing
  the terminology from Haskell again, we will call this <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Init›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Init</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≡</span> restrict<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span>pred<span class="main">(</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Another obvious operation we can talk about is appending an element
  at the end of a sequence. This is called <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Append›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Append</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="main">⟨</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">⟩</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If lists are modeled as finite sequences (i.e. functions on natural 
  intervals $\{0,1,..,n-1\} = n$) it is easy to get the first element
  of a list as the value of the sequence at $0$. The last element is the
  value at $n-1$. To hide this behind a familiar name we define the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Last›</span></span></span></span>
  element of a list.›</span></span> 

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Last</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≡</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">`</span><span class="main">(</span>pred<span class="main">(</span>domain<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Shifted sequence is a function on a the interval of natural numbers.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> shifted_seq_props<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">:</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">k</span><span class="main">.</span> ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>   
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span>domain<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> Fact<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?I</span> <span class="main">=</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> func1_1_L1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span> <span class="var">?I</span><span class="main">.</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> inter_diff_in_len apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">j</span><span class="main">,</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">j</span> <span class="main">∈</span> <span class="var">?I</span><span class="main">}</span> <span class="main">:</span> <span class="var">?I</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> Fact <span class="keyword3"><span class="command">show</span></span> thesis_1<span class="main">:</span> <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">:</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ShiftedSeq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> 
    <span class="keyword1"><span class="command">from</span></span> Fact thesis_1 <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">:</span> <span class="var">?I</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Fact <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?I</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> Fact <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?I</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ShiftedSeq_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>  <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_tot_val<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> thesis1<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> 
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> nat"</span></span> <span class="keyword1"><span class="command">using</span></span> elem_nat_is_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">#-</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_add_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A3 thesis1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="var">?i</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NatInterval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">k</span><span class="main">.</span> ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Basis properties of the contatenation of two finite sequences.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> concat_props<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">:</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span>  <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">:</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∩</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> shifted_seq_props length_start_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∪</span> ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">:</span> <span class="free">n</span> <span class="main">∪</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span> <span class="main">∪</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fun_disjoint_Un<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">:</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 Concat_def length_start_decomp <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A1 I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> domain<span class="main">(</span>ShiftedSeq<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> length_start_decomp func1_1_L1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> func1_1_L1 fun_disjoint_apply1 Concat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∉</span> domain<span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> length_start_decomp func1_1_L1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span>  <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> func1_1_L1 fun_disjoint_apply2 Concat_def shifted_seq_props
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span>  <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span> <span class="main">#-</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?i</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> nat"</span></span> <span class="keyword1"><span class="command">using</span></span> elem_nat_is_nat <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?i</span> <span class="main">#-</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">j</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> diff_add_inverse <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">with</span></span> A3 II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="var">?i</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> NatInterval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of concatenating three lists.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> concat_concat_list<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">:</span><span class="free">m</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">=</span> Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> <span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">∈</span> nat"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> nat"</span></span>
    <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">:</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">→</span> <span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">:</span><span class="free">m</span><span class="main">→</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">:</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span><span class="main">.</span> 
    Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">⊆</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A3 II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>  Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> A1 A2 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A1 A3 II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_lt_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 A5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> <span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">d</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of concatenating a list with a concatenation
  of two other lists.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> concat_list_concat<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">:</span><span class="free">m</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> <span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">∈</span> nat"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>  <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">:</span> <span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_props add_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span> <span class="main">#+</span> <span class="free">m</span><span class="main">.</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">k</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">⊆</span> <span class="free">k</span> <span class="main">#+</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> add_nat_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">k</span> <span class="main">#+</span> <span class="free">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A3 II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span>  Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> <span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> A1 II A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="free">k</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> add_lt_mono add_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 A5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="skolem">j</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="free">m</span><span class="main">.</span> <span class="free">e</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Concatenation is associative.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> concat_assoc<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">m</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">:</span><span class="free">m</span><span class="main">→</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span> <span class="main">=</span>  Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?e</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_concat_list concat_list_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span>  <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span><span class="main">.</span> <span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?e</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> 
	<span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#+</span><span class="free">k</span> <span class="main">#+</span> <span class="free">m</span> <span class="main">=</span> <span class="free">n</span> <span class="main">∪</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∪</span> NatInterval<span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span><span class="main">,</span><span class="free">m</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> adjacent_intervals3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
	<span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">n</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span> <span class="main">∨</span> <span class="skolem">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span><span class="main">,</span><span class="free">m</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>
	<span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?e</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> concat_concat_list concat_list_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">k</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span><span class="main">∈</span><span class="free">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> NatInterval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?e</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> concat_concat_list concat_list_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> NatInterval<span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="free">k</span><span class="main">,</span><span class="free">m</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">j</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">=</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">#+</span> <span class="skolem">j</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> NatInterval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?e</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> concat_concat_list concat_list_concat <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">=</span> <span class="var">?e</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?d</span> <span class="main">=</span> <span class="var">?e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Tail›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tail_props<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> succ_ineq apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="free">n</span><span class="main">}</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 pred_succ_eq Tail_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="free">n</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 pred_succ_eq Tail_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_tot_val0<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Append›</span></span></span></span>. It is a bit surprising that
  the we don't need to assume that $n$ is a natural number.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> append_props<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> A1
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∉</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mem_not_refl <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A3 <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∪</span> <span class="main">{</span><span class="main">⟨</span><span class="free">n</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 Append_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> <span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">→</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func1_1_L11D<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> succ_explained set_elem_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> A1 I II <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L11D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A special case of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>append_props›</span></span></span></span>: appending to a nonempty
  list does not change the head (first element) of the list.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> head_of_append<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms append_props empty_in_every_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="comment1">(*text{*A bit technical special case of @{text "append_props"} that tells us
  what is the value of the appended list at the sucessor of some argument.*}

corollary append_val_succ:
  assumes "n ∈ nat" and "a: succ(n) → X" and "x∈X" and "k ∈ n"
  shows "Append(a,x)`(succ(k)) = a`(succ(k))"
  using assms succ_ineq append_props by simp*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Tail›</span></span></span></span> commutes with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Append›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> tail_append_commute<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Tail<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Tail<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tail_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="var">?c</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> tail_props<span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tail_props append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">n</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>
	<span class="keyword1"><span class="command">with</span></span> assms II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> succ_ineq append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">moreover</span></span>
	<span class="keyword1"><span class="command">from</span></span> A3 I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">with</span></span> A1 A2 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span>  <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> tail_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
	<span class="keyword1"><span class="command">with</span></span> A2 A3 I II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?c</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span> <span class="var">?c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Properties of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Init›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> init_props<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> Append<span class="main">(</span>Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">⊆</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> restrict_type2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 pred_succ_eq Init_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> thesis1<span class="main">:</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">∈</span><span class="free">n</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> restrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> thesis2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A2 thesis1 <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span>
    <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span> Append<span class="main">(</span>Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">,</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> A2
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> append_props<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> append_props<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> thesis2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> 
    <span class="keyword1"><span class="command">from</span></span> II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> append_props<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">" <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="var">?b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If we take init of the result of append, we get back the same list.›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> init_append<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> Init<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">using</span></span> init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> Init<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹Init<span class="main">(</span>Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>›</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A reformulation of definition of  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Init›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> init_def<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">:</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">x</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms func1_1_L1 Init_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A lemma about extending a finite sequence by one more value. This is 
  just a more explicit version of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>append_props›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finseq_extend<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">y</span><span class="main">∈</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main">∪</span> <span class="main">{</span><span class="main">⟨</span><span class="free">n</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">y</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms Append_def func1_1_L1 append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next lemma is a bit displaced as it is mainly 
  about finite sets. It is proven here because it uses
  the notion of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Append›</span></span></span></span>.
  Suppose we have a list of element of $A$ is a bijection.
  Then for every element that does not belong to $A$ 
  we can we can construct 
  a bijection for the set $A \cup \{ x\}$ by appending $x$.
  This is just a specialised version of lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bij_extend_point›</span></span></span></span>
  from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>func1.thy›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> bij_append_point<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">n</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">∈</span> bij<span class="main">(</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">,</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∪</span> <span class="main">{</span><span class="main">⟨</span><span class="free">n</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">n</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">,</span><span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> mem_not_refl bij_extend_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∪</span> <span class="main">{</span><span class="main">⟨</span><span class="free">n</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> bij_def surj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> func1_1_L1B
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span> <span class="main">∪</span> <span class="main">{</span><span class="main">⟨</span><span class="free">n</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Append_def func1_1_L1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> succ_explained <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next lemma rephrases the definition of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Last›</span></span></span></span>.
  Recall that in ZF we have $\{0,1,2,..,n\} = n+1=$<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>succ›</span></span></span></span>$(n)$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> last_seq_elem<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Last<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms func1_1_L1 pred_succ_eq Last_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If two finite sequences are the same when restricted to domain one 
  shorter than the original and have the same value on the last element, 
  then they are equal.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> finseq_restr_eq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> restrict<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">n</span> <span class="main">∨</span> <span class="skolem">k</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
	<span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">n</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> restrict <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="free">b</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Concatenating a list of length $1$ is the same as appending its
  first (and only) element. Recall that in ZF set theory 
  $1 = \{ 0 \} $.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> append_1elem<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">=</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> nat"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_funtype append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?A</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span><span class="free">n</span><span class="main">.</span> <span class="var">?A</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> apply_funtype append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span>  <span class="var">?A</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?A</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> <span class="main">1</span><span class="main">.</span> <span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A1 A2 A3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="var">?A</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> apply_funtype append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?A</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="main">=</span> <span class="var">?A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A simple lemma about lists of length $1$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_len1_singleton<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span> <span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span> <span class="main">:</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pair_func_singleton
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A singleton list is in fact a singleton set with a pair as the only element.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_singleton_pair<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">t</span><span class="main">,</span><span class="free">x</span><span class="main">`</span><span class="main">(</span><span class="bound">t</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="main">1</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fun_is_set_of_pairs<span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">t</span><span class="main">,</span><span class="free">x</span><span class="main">`</span><span class="main">(</span><span class="bound">t</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">t</span><span class="main">∈</span><span class="main">{</span><span class="main">0</span><span class="main">}</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>  
 
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹When we append an element to the empty list we get
  a list with length $1$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> empty_append1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?a</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Append_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span> <span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_len1_singleton pair_func_singleton
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="comment1">(*text{*Tail of a list of length 1 is a list of length 0.*}

lemma list_len1_tail: assumes "a:1→X"
  shows "Tail(a) : 0 → X"
  using assms tail_props by blast *)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Appending an element is the same as concatenating
  with certain pair.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> append_concat_pair<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms list_len1_singleton append_1elem pair_val
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An associativity property involving concatenation 
  and appending. For proof we just convert appending to
  concatenation and use <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>concat_assoc›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> concat_append_assoc<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Append<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">∈</span> nat"</span></span>   <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">#+</span> <span class="free">k</span> <span class="main">→</span> <span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> concat_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span>  Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> append_concat_pair<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">∈</span> nat"</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span><span class="free">k</span><span class="main">→</span><span class="free">X</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span> <span class="main">:</span>  <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_len1_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"Concat<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="free">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span>  Append<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> list_len1_singleton append_1elem pair_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span> Append<span class="main">(</span><span class="free">b</span><span class="main">,</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An identity involving concatenating with init
  and appending the last element.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> concat_init_last_elem<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span>Init<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms init_props apply_funtype concat_append_assoc
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A lemma about creating lists by composition and how
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Append›</span></span></span></span> behaves in such case.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_compose_append<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">:</span> <span class="free">X</span> <span class="main">→</span> <span class="free">Y</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">O</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">Y</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">O</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Append<span class="main">(</span><span class="free">c</span> <span class="keyword1">O</span> <span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?d</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span><span class="free">c</span> <span class="keyword1">O</span> <span class="free">a</span><span class="main">,</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A2 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">O</span> <span class="free">a</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A4 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">O</span> <span class="var">?b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_fun <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A3 A4 <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="keyword1">O</span> <span class="free">a</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="var">?d</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_funtype append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span> <span class="keyword1">O</span> <span class="var">?b</span><span class="main">)</span> <span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
	<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="keyword1">O</span> <span class="var">?b</span><span class="main">)</span> <span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="var">?b</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> comp_fun_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> A2 A3 A4 <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="keyword1">O</span> <span class="free">a</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">c</span> <span class="keyword1">O</span> <span class="free">a</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">Y</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="keyword1">O</span> <span class="var">?b</span><span class="main">)</span> <span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="var">?d</span><span class="main">`</span><span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> append_props comp_fun_apply apply_funtype
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="keyword1">O</span> <span class="var">?b</span> <span class="main">=</span> <span class="var">?d</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A lemma about appending an element to a list defined by set
  comprehension.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> set_list_append<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> 
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">k</span><span class="main">}</span><span class="main">:</span> <span class="free">k</span> <span class="main">→</span> <span class="free">X</span>"</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> Append<span class="main">(</span><span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">k</span><span class="main">}</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">}</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">k</span><span class="main">.</span> <span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">k</span><span class="main">}</span><span class="main">:</span> <span class="free">k</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">=</span> Append<span class="main">(</span><span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">k</span><span class="main">}</span><span class="main">,</span><span class="free">b</span><span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 Append_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An induction theorem for lists.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_induct<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>NELists<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span>Append<span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">d</span> <span class="main">∈</span> NELists<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">∈</span>nat"</span></span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span>nat<span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">c</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">c</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">c</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">c</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span><span class="main">:</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> A2 <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span>Append<span class="main">(</span><span class="var">?b</span><span class="main">,</span><span class="bound">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> NELists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span>Append<span class="main">(</span><span class="var">?b</span><span class="main">,</span><span class="var">?x</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">c</span><span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span><span class="main">(</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span><span class="main">∈</span>succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="free">P</span><span class="main">(</span><span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ind_on_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">with</span></span> A3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> NELists_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lists and cartesian products›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lists of length $n$ of elements of some set $X$ can be thought of as a 
model of the cartesian product $X^n$ which is more convenient in many applications.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There is a natural bijection between the space $(n+1)\rightarrow X$ of lists of length 
$n+1$ of elements of $X$ and the cartesian product $(n\rightarrow X)\times X$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> lists_cart_prod<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="main">⟨</span>Init<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">⟩</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">}</span> <span class="main">∈</span> bij<span class="main">(</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">,</span><span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="main">⟨</span>Init<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">⟩</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="main">⟨</span>Init<span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">,</span><span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">⟩</span> <span class="main">∈</span> <span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> init_props succ_iff apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">:</span> <span class="main">(</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">→</span><span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> ZF_fun_from_tot_val init_def finseq_restr_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">p</span><span class="main">∈</span><span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span><span class="main">.</span><span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="bound">p</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">∈</span> <span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Append<span class="main">(</span>fst<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">,</span>snd<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span><span class="main">:</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span>Init<span class="main">(</span><span class="var">?x</span><span class="main">)</span><span class="main">,</span><span class="var">?x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_iff ZF_fun_from_tot_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="var">?x</span><span class="main">)</span> <span class="main">=</span> fst<span class="main">(</span><span class="skolem">p</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> snd<span class="main">(</span><span class="skolem">p</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> init_append append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span>fst<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">,</span>snd<span class="main">(</span><span class="skolem">p</span><span class="main">)</span><span class="main">⟩</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span> <span class="main">∈</span> <span class="main">(</span><span class="free">n</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">×</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?x</span><span class="main">:</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> inj_def surj_def bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can identify a set $X$ with lists of length one of elements of $X$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> singleton_list_bij<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">}</span> <span class="main">∈</span> bij<span class="main">(</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">:</span><span class="main">(</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span> <span class="main">⟶</span> <span class="bound">x</span><span class="main">=</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">=</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="skolem">y</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">with</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZF_fun_from_tot_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="skolem">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="skolem">y</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">}</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> list_singleton_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free">X</span><span class="main">.</span> <span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> I <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="var">?x</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> list_len1_singleton ZF_fun_from_tot_val pair_val <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> inj_def surj_def bij_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can identify a set of $X$-valued lists of length with $X$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> list_singleton_bij<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">⟩</span><span class="main">.</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">}</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">y</span><span class="main">,</span><span class="bound">y</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">}</span> <span class="main">=</span> converse<span class="main">(</span><span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">⟩</span><span class="main">.</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">⟩</span><span class="main">.</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">}</span> <span class="main">=</span> converse<span class="main">(</span><span class="main">{</span><span class="main">⟨</span><span class="bound">y</span><span class="main">,</span><span class="bound">y</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">y</span><span class="main">,</span><span class="bound">y</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?g</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">x</span><span class="main">,</span><span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">x</span><span class="main">⟩</span><span class="main">}</span><span class="main">⟩</span><span class="main">.</span><span class="bound">x</span><span class="main">∈</span><span class="free">X</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">∈</span> bij<span class="main">(</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">,</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">:</span><span class="free">X</span><span class="main">→</span><span class="main">(</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> singleton_list_bij pair_func_singleton ZF_fun_from_total  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span><span class="var">?g</span><span class="main">`</span><span class="main">(</span><span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="bound">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">y</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">y</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span><span class="main">:</span><span class="main">(</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> singleton_list_bij bij_def inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?g</span><span class="main">:</span><span class="free">X</span><span class="main">→</span><span class="main">(</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span><span class="main">`</span><span class="main">(</span><span class="var">?f</span><span class="main">`</span><span class="main">(</span><span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> ZF_fun_from_tot_val apply_funtype func_singleton_pair
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">∈</span> bij<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?f</span> <span class="main">=</span> converse<span class="main">(</span><span class="var">?g</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?g</span> <span class="main">=</span> converse<span class="main">(</span><span class="var">?f</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> comp_conv_id <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What is the inverse image of a set by the natural bijection between $X$-valued 
  singleton lists and $X$?›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> singleton_vimage<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">U</span><span class="main">⊆</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span> <span class="skolem">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">⟩</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> func_singleton_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="skolem">y</span><span class="main">⟩</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">U</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">1</span> <span class="main">=</span> <span class="main">{</span><span class="main">0</span><span class="main">}</span>›</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span><span class="main">1</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pair_func_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">{</span><span class="main">⟨</span><span class="main">0</span><span class="main">,</span><span class="bound">y</span><span class="main">⟩</span><span class="main">}</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="bound">x</span><span class="main">∈</span><span class="main">1</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A technical lemma about extending a list by values from a set.›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> list_append_from<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">U</span> <span class="main">⊆</span> <span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> Init<span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span><span class="main">{</span>Append<span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="bound">x</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> Init<span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Append<span class="main">(</span>Init<span class="main">(</span><span class="skolem">x</span><span class="main">)</span><span class="main">,</span><span class="var">?y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> I <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹Init<span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span><span class="main">{</span>Append<span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="bound">a</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free">V</span><span class="main">.</span><span class="main">{</span>Append<span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span><span class="bound">a</span><span class="main">∈</span><span class="free">U</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">∈</span><span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Append<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> append_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">U</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">:</span><span class="free">n</span><span class="main">→</span><span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span><span class="main">∈</span><span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> A1 <span class="quoted"><span class="quoted">‹<span class="skolem">a</span><span class="main">∈</span><span class="free">U</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">y</span><span class="main">∈</span><span class="free">V</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">=</span> Append<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">y</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> append_props init_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">x</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">X</span><span class="main">.</span> Init<span class="main">(</span><span class="bound">x</span><span class="main">)</span> <span class="main">∈</span> <span class="free">U</span> <span class="main">∧</span> <span class="bound">x</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">V</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</body>

</html>