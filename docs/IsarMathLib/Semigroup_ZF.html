<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><link rel="stylesheet" type="text/css" href="isabelle.css"/>
<title>Theory Semigroup_ZF</title>
</head>


<body>
<div class="head">
<h1>Theory Semigroup_ZF</h1>
</div>

<pre class="source"><span class="comment1">(* 
    This file is a part of IsarMathLib - 
    a library of formalized mathematics for Isabelle/Isar.

    Copyright (C) 2007-2009  Slawomir Kolodynski

    This progr\rightarowam is free software; Redistribution and use in source and binary forms, 
    with or without modification, are permitted provided that the following conditions are met:

   1. Redistributions of source code must retain the above copyright notice, 
   this list of conditions and the following disclaimer.
   2. Redistributions in binary form must reproduce the above copyright notice, 
   this list of conditions and the following disclaimer in the documentation and/or 
   other materials provided with the distribution.
   3. The name of the author may not be used to endorse or promote products 
   derived from this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE AUTHOR ``AS IS'' AND ANY EXPRESS OR IMPLIED 
WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF 
MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. 
IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, 
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, 
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; 
OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, 
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR 
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, 
EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Semigroups›</span></span>

<span class="keyword1"><span class="command">theory</span></span> Semigroup_ZF <span class="keyword2"><span class="keyword">imports</span></span> <a href="Partitions_ZF.html">Partitions_ZF</a> <a href="Fold_ZF.html">Fold_ZF</a> <a href="Enumeration_ZF.html">Enumeration_ZF</a>

<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It seems that the minimal setup needed to talk about a product of a 
  sequence is a set with a binary operation. 
  Such object is called "magma". However, interesting properties
  show up when the binary operation is associative and such alebraic structure
  is called a semigroup. 
  In this theory file we define and study sequences of partial 
  products of sequences of magma and semigroup elements.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Products of sequences of semigroup elements›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Semigroup is a a magma in which the binary operation is associative.
  In this section we mostly study the products of sequences of elements 
  of semigroup. The goal is to establish the fact that taking the product of 
  a sequence is distributive with respect to concatenation of sequences, 
  i.e for two sequences $a,b$ of the semigroup elements we have 
  $\prod (a\sqcup b) = (\prod a)\cdot (\prod b)$, where "$a \sqcup b$" 
  is concatenation of $a$ and $b$ ($a$<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>++›</span></span></span></span>$b$ in Haskell notation).
  Less formally, we want to show that we can discard parantheses in 
  expressions of the form 
  $(a_0\cdot a_1\cdot .. \cdot a_n)\cdot (b_0\cdot .. \cdot b_k)$.
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹First we define a notion similar to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Fold›</span></span></span></span>, except that
  that the initial element of the fold is given by the first element
  of sequence. By analogy with Haskell fold we call that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Fold1›</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Fold1</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">≡</span> Fold<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">,</span>Tail<span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definition of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> context below introduces notation
  for writing about finite sequences and semigroup products. 
  In the context we fix the carrier and
  denote it $G$. The binary operation on $G$ is called $f$. 
  All theorems proven in the context <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> 
  will implicitly assume that $f$ is an associative operation on $G$.
  We will use multiplicative notation for the semigroup operation.
  The product of a sequence $a$ is denoted $\prod a$.
  We will write
  $a\hookleftarrow x$ for the result of appending an element $x$ to
  the finite sequence (list) $a$. This is a bit nonstandard, 
  but I don't have a better idea for the "append" notation. Finally,
  $a\sqcup b$ will denote the concatenation of the lists $a$ and $b$.›</span></span>

<span class="keyword1"><span class="command">locale</span></span> semigr0 <span class="main">=</span>
  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="free">f</span>

  <span class="keyword2"><span class="keyword">assumes</span></span> assoc_assum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">associative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">prod</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">⋅</span></span>"</span> 72<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> prod_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main"><span class="free">⋅</span></span> <span class="free">y</span> <span class="main">≡</span> <span class="free">f</span><span class="main">`</span><span class="main">⟨</span><span class="free">x</span><span class="main">,</span><span class="free">y</span><span class="main">⟩</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">seqprod</span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1">∏</span></span> _"</span> 71<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> seqprod_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">∏</span></span> <span class="free">a</span> <span class="main">≡</span> Fold1<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">append</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">↩</span></span>"</span> 72<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> append_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">↩</span></span> <span class="free">x</span> <span class="main">≡</span> Append<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">x</span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">concat</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixl</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1">⊔</span></span>"</span> 69<span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> concat_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="free">b</span> <span class="main">≡</span> Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The next lemma shows our assumption on the associativity
  of the semigroup operation in the notation defined in in the 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> context.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> semigr_assoc<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">z</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main"><span class="free">⋅</span></span><span class="free">y</span><span class="main"><span class="free">⋅</span></span><span class="free">z</span> <span class="main">=</span> <span class="free">x</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">y</span><span class="main"><span class="free">⋅</span></span><span class="free">z</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms assoc_assum IsAssociative_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In the way we define associativity the assumption that
  $f$ is associative on $G$ also implies that it is a binary
  operation on $X$.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> semigr_binop<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span> <span class="free">G</span><span class="main">×</span><span class="free">G</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assoc_assum IsAssociative_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Semigroup operation is closed.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> semigr_closed<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms semigr_binop apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>append_1elem›</span></span></span></span> written in the notation used in 
  the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> context.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> append_1elem_nice<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="free">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">↩</span></span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms append_1elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>concat_init_last_elem›</span></span></span></span> rewritten
  in the notation used in the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> context.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> concat_init_last<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">X</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> Init<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">↩</span></span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms concat_init_last_elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The product of semigroup (actually, magma -- we don't
   need associativity for this) elements is in the semigroup.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_type<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span> <span class="free">G</span><span class="main">×</span><span class="free">G</span> <span class="main">→</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> semigr_binop tail_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> empty_in_every_succ apply_funtype
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Fold1_def fold_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What is the product of one element list?›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_of_1elem<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">:</span> <span class="free">G</span><span class="main">×</span><span class="free">G</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> semigr_binop <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="main">0</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> tail_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>  <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> fold_empty Fold1_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What happens to the product of a list when we append an element 
  to the list?›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_append<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span><span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main"><span class="free">↩</span></span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> tail_props empty_in_every_succ apply_funtype
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main"><span class="free">↩</span></span><span class="free">x</span><span class="main">)</span> <span class="main">=</span> Fold<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">,</span>Tail<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main"><span class="free">↩</span></span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> head_of_append tail_append_commute Fold1_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A3 I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> semigr_binop fold_append Fold1_def 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The main theorem of the section: taking the product of 
  a sequence is distributive with respect to concatenation of sequences.
  The proof is by induction on the length of the second list.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_conc_distr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="free">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span>
	<span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">G</span>"</span></span> 
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="skolem">b</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">↩</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> append_1elem_nice<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A1 A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> apply_funtype prod_append semigr_binop prod_of_1elem
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span> <span class="main">∈</span> nat<span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">j</span> <span class="keyword3"><span class="command">assume</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">j</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
      A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="keyword3"><span class="command">assume</span></span> A6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	<span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">from</span></span> A4 A6 <span class="keyword1"><span class="command">have</span></span>  T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">=</span> <span class="var">?c</span><span class="main"><span class="free">↩</span></span><span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> apply_funtype init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">from</span></span> A1 A2 A4 A6 <span class="keyword1"><span class="command">have</span></span>
	  <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span>
	  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> III<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="var">?c</span><span class="main">)</span> <span class="main"><span class="free">↩</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="skolem">b</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_init_last<span class="main">)</span>
	<span class="keyword1"><span class="command">from</span></span> A4 I T <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?c</span><span class="main"><span class="free">↩</span></span><span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?c</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_append<span class="main">)</span>
	<span class="keyword1"><span class="command">with</span></span> II <span class="keyword1"><span class="command">have</span></span> 
	  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?c</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 A4 T I <span class="keyword1"><span class="command">have</span></span>
	  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?c</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> prod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> 
	  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> semigr_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">with</span></span> A5 I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">moreover</span></span>
	<span class="keyword1"><span class="command">from</span></span> A1 A2 A4 I <span class="keyword1"><span class="command">have</span></span>
	  T1<span class="main">:</span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Concat<span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="var">?c</span><span class="main">)</span><span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">#+</span> succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> concat_props<span class="main">)</span>
	<span class="keyword1"><span class="command">with</span></span> A1 A4 T <span class="keyword1"><span class="command">have</span></span>
	  <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">n</span> <span class="main">#+</span> <span class="skolem">j</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span>   
	  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="var">?c</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="free">n</span> <span class="main">#+</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	  <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
	  <span class="keyword1"><span class="command">using</span></span> succ_plus <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 
	  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="var">?c</span><span class="main">)</span><span class="main"><span class="free">↩</span></span><span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_append<span class="main">)</span>
	<span class="keyword1"><span class="command">with</span></span> III <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="var">?c</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>  <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">j</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ind_on_nat<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="main"><span class="free">⊔</span></span> <span class="free">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Products over sets of indices›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In this section we study the properties of 
  expressions of the form
  $\prod_{i\in \Lambda} a_i = a_{i_0}\cdot a_{i_1} \cdot .. \cdot a_{i-1}$,
  i.e. what we denote as <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>\&lt;pr&gt;(Λ,a)›</span></span></span></span>. $\Lambda$ here is
  a finite subset of some set $X$ and $a$ is a function defined
  on $X$ with values in the semigroup $G$.›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Suppose $a: X \rightarrow G$ is an indexed family of elements
  of a semigroup $G$ and 
  $\Lambda = \{i_0, i_1, .. , i_{n-1}\} \subseteq \mathbb{N}$ is a finite 
  set of indices. We want to define 
  $\prod_{i\in \Lambda} a_i = a_{i_0}\cdot a_{i_1} \cdot .. \cdot a_{i-1}$.
  To do that we use the notion of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Enumeration›</span></span></span></span> defined in the
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Enumeration_ZF›</span></span></span></span> theory file that takes a set of indices and 
  lists them in increasing order, thus converting it to list. Then we use 
  the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Fold1›</span></span></span></span> to multiply the resulting list. Recall that in 
  Isabelle/ZF the capital letter ''O'' denotes the composition of two 
  functions (or relations).
›</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SetFold</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Λ</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">=</span> Fold1<span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">O</span> Enumeration<span class="main">(</span><span class="free"><span class="bound"><span class="entity">Λ</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For 
  a finite subset $\Lambda$ of a linearly ordered set $X$
  we will write $\sigma (\Lambda )$ 
  to denote the enumeration of the elements of $\Lambda$, i.e. the only 
  order isomorphism $|\Lambda | \rightarrow \Lambda$, where 
  $|\Lambda | \in \mathbb{N}$ is the number of elements of $\Lambda $.
  We also define
  notation for taking a product over a set of indices of some sequence
  of semigroup elements. The product of semigroup
  elements over some set $\Lambda \subseteq X$ of indices
  of a sequence $a: X \rightarrow G$ (i.e. $\prod_{i\in \Lambda} a_i$) 
  is denoted <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>\&lt;pr&gt;(Λ,a)›</span></span></span></span>.
  In the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr1›</span></span></span></span> context we assume that $a$ is a 
  function defined on some
  linearly ordered set $X$ with values in the semigroup $G$.
›</span></span>

<span class="keyword1"><span class="command">locale</span></span> semigr1 <span class="main">=</span> semigr0 <span class="main">+</span>
  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span> <span class="free">r</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> linord<span class="main">:</span> <span class="quoted"><span class="quoted">"IsLinOrder<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">a</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a_is_fun<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> <span class="free">X</span> <span class="main">→</span> <span class="free">G</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">σ</span>
  <span class="keyword2"><span class="keyword">defines</span></span> σ_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">A</span><span class="main">)</span> <span class="main">≡</span> Enumeration<span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>

  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">setpr</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">\&lt;pr&gt;</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">defines</span></span> setpr_def <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">≡</span> SetFold<span class="main">(</span><span class="free">f</span><span class="main">,</span><span class="free">b</span><span class="main">,</span><span class="free">Λ</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can use the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>enums›</span></span></span></span> locale in the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> 
  context.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> enums_valid_in_semigr1<span class="main">:</span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enums<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> linord enums_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Definition of product over a set expressed
  in notation of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span> locale.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> setproddef<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> SetFold_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A composition of enumeration of a nonempty 
  finite subset of $\mathbb{N}$
  with a sequence of elements of $G$ is a nonempty list of elements of $G$.
  This implies that a product over set of a finite set of indices belongs
  to the (carrier of) semigroup.
›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> setprod_type<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Λ</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Λ</span><span class="main">≠</span><span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> nat <span class="main">.</span> <span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> card_non_empty_succ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span> <span class="main">:</span> <span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">→</span> <span class="free">Λ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> enums_valid_in_semigr1 enums.enum_props 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main">:</span> <span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_is_fun FinPow_def comp_fun_subset 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> nat›</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">n</span> <span class="main">∈</span> nat <span class="main">.</span> <span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="bound">n</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> nat›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">=</span> succ<span class="main">(</span><span class="skolem">n</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main">:</span> <span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">→</span> <span class="free">G</span>›</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_type setproddef 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>enum_append›</span></span></span></span> lemma from the 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Enemeration›</span></span></span></span> theory specialized for natural
  numbers.›</span></span> 

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> semigr1_enum_append<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">Λ</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="free">Λ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">Λ</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span><span class="free">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">Λ</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main"><span class="free">↩</span></span> <span class="free">n</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms  FinPow_def enums_valid_in_semigr1 
    enums.enum_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What is product over a singleton?›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> gen_prod_singleton<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">:</span> <span class="main">1</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> enums_valid_in_semigr1 enums.enum_singleton
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">{</span><span class="free">x</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_is_fun comp_fun setproddef prod_of_1elem 
      comp_fun_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A generalization of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_append›</span></span></span></span> to the products
  over sets of indices.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> gen_prod_append<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Λ</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Λ</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span>  <span class="free">Λ</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">Λ</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span><span class="free">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span>  <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> setproddef <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A3 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="main">(</span><span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main"><span class="free">↩</span></span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> semigr1_enum_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">↩</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A1 A3 <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span> <span class="main">:</span> <span class="main">|</span><span class="free">Λ</span><span class="main">|</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> card_fin_is_nat enums_valid_in_semigr1 enums.enum_fun
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> a_is_fun list_compose_append
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">σ</span><span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_is_fun setprod_type apply_funtype prod_append
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> SetFold_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Very similar to <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>gen_prod_append›</span></span></span></span>: a relation
  between a product over a set of indices and the product
  over the set with the maximum removed.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> gen_product_rem_point<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="free">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">A</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Λ</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Λ</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span>  <span class="var">?Λ</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> fin_rem_point_fin FinPow_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A3 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Λ</span> <span class="main">∪</span> <span class="main">{</span><span class="free">n</span><span class="main">}</span><span class="main">,</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_is_fun gen_prod_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> A2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> rem_add_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Commutative semigroups›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Commutative semigroups are those whose operation is 
  commutative, i.e. $a\cdot b = b\cdot a$. This implies that
  for any permutation $s : n \rightarrow n$ we have
  $\prod_{j=0}^n a_j = \prod_{j=0}^n a_{s (j)}$,
  or, closer to the notation we are using in the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>semigr0›</span></span></span></span>
  context, $\prod a = \prod (a \circ s )$. Maybe one day we 
  will be able to prove this, but for now the goal is to prove 
  something simpler: that if the semigroup operation is commutative
  taking the product of a sequence is distributive with respect
  to the operation: 
  $\prod_{j=0}^n (a_j\cdot b_j) = \left(\prod_{j=0}^n a_j)\right) \left(\prod_{j=0}^n b_j)\right)$.
  Many of the rearrangements (namely those that don't use the inverse)
  proven in the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>AbelianGroup_ZF›</span></span></span></span> theory hold in fact in semigroups.
  Some of them will be reproven in this section.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A rearrangement with 3 elements.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> rearr3elems<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms semigr_assoc IsCommutative_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A rearrangement of four elements.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> rearr4elems<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">∈</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">∈</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">∈</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">d</span><span class="main">∈</span><span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> semigr_closed semigr_assoc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span> <span class="main">=</span>  <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span> <span class="main">=</span> <span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IsCommutative_def semigr_closed 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> semigr_closed semigr_assoc 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A1 A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> IsCommutative_def semigr_closed 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> semigr_closed semigr_assoc
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span> <span class="main">=</span>  <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main"><span class="free">⋅</span></span><span class="free">c</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="free">b</span><span class="main"><span class="free">⋅</span></span><span class="free">d</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We start with a version of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_append›</span></span></span></span> that will shorten a bit
  the proof of the main theorem.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> shorter_seq<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> apply_funtype init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?x</span><span class="main"><span class="free">↩</span></span><span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?x</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> init_props
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A lemma useful in the induction step of the main theorem.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_distr_ind_step<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Init<span class="main">(</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> Init<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A1 A2 A3 A4 <span class="keyword3"><span class="command">show</span></span> 
    <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">a</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">b</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="free">c</span><span class="main">)</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> init_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> A1 <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="free">k</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> T A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> init_props<span class="main">)</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> T A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Init<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> init_props<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> T A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Init<span class="main">(</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> init_props<span class="main">)</span>
   <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">k</span><span class="main">)</span><span class="main">.</span> Init<span class="main">(</span><span class="free">c</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> Init<span class="main">(</span><span class="free">a</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> Init<span class="main">(</span><span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For commutative operations taking the product of a sequence 
  is distributive with respect to the operation.
  This version will probably not be used in applications,
  it is formulated in a way that is easier to prove by induction.
  For a more convenient formulation see <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_comm_distrib›</span></span></span></span>.
  The proof by induction on the length of the sequence.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_comm_distr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span>nat"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> 
  <span class="main">(</span><span class="bound">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> 
  <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
  <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> A2
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> 
    <span class="main">(</span><span class="bound">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> 
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="skolem">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="skolem">c</span> <span class="main">:</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> 
	<span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
	I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">:</span> <span class="main">1</span><span class="main">→</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">:</span> <span class="main">1</span><span class="main">→</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">:</span> <span class="main">1</span><span class="main">→</span><span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">c</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span>
	<span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">c</span><span class="main">`</span><span class="main">(</span><span class="main">0</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> prod_of_1elem <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> Fold1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> nat<span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> 
    <span class="main">(</span><span class="bound">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">:</span> succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span> 
    <span class="main">(</span><span class="bound">a</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">→</span><span class="free">G</span> <span class="main">∧</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> nat"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span>
      <span class="bound">a</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
      <span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span>
      <span class="bound">a</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
      <span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
      <span class="bound">c</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
      <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span>
	<span class="bound">a</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
	<span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> 
	<span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
	<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span><span class="main">.</span>
	<span class="bound">a</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
	<span class="bound">b</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
	<span class="bound">c</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> 
	<span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="bound">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="bound">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
	<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="bound">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
	<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> 
	  <span class="keyword3"><span class="command">assume</span></span> 
	    <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
	    <span class="skolem">b</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span>
	    <span class="skolem">c</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span> <span class="main">∧</span> 
	    <span class="main">(</span><span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span>
	    <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	    <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	    <span class="quoted"><span class="quoted">"<span class="skolem">c</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	    <span class="keyword2"><span class="keyword">and</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
	  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">a</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">b</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"Init<span class="main">(</span><span class="skolem">c</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> I <span class="keyword1"><span class="command">have</span></span> III<span class="main">:</span>
	    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?x</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?y</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	    IV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?z</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">c</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">using</span></span>  shorter_seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	  <span class="keyword1"><span class="command">moreover</span></span>
	  <span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> I II <span class="keyword1"><span class="command">have</span></span>
	    <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	    <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span>
	    <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="var">?z</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="var">?x</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="var">?y</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">using</span></span> prod_distr_ind_step <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	  <span class="keyword1"><span class="command">with</span></span> A3 II IV <span class="keyword1"><span class="command">have</span></span>
	    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?x</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?y</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="skolem">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A1 <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> I III <span class="keyword1"><span class="command">have</span></span>
	    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?x</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?y</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="skolem">a</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="skolem">b</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">=</span>
	    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span>"</span></span> 
	    <span class="keyword1"><span class="command">using</span></span> init_props prod_type apply_funtype 
	      rearr4elems <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ind_on_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A reformulation of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_comm_distr›</span></span></span></span> that is more
  convenient in applications.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr0<span class="main">)</span> prod_comm_distrib<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">∈</span>nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">:</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">→</span><span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">j</span><span class="main">∈</span>succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="free">c</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">j</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">a</span><span class="main">)</span> <span class="main"><span class="free">⋅</span></span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="free">b</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prod_comm_distr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A product of two products over disjoint sets of indices is the 
  product over the union.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> prod_bisect<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Λ</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> 
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="free">Λ</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">Λ</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"IsLinOrder<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> linord <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bisec_empty <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
    <span class="main">(</span> <span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="bound">A</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">P</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="bound">A</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
    <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="bound">A</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span><span class="bound">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">)</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="bound">A</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> 
    <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">A</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">∀</span><span class="bound">P</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span><span class="main">.</span> 
	<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> 
	<span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span><span class="skolem">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span> <span class="main">)</span>  <span class="main">⟶</span> 
	<span class="main">(</span><span class="main">∀</span><span class="bound">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> 
	<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
	<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> I<span class="main">:</span>
	  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">P</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">P</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword2"><span class="keyword">and</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span><span class="main">∈</span><span class="skolem">A</span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span><span class="skolem">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span>
	  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> 
	    <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>fst<span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span>snd<span class="main">(</span><span class="bound">Q</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
	    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">Q</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"fst<span class="main">(</span><span class="skolem">Q</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"snd<span class="main">(</span><span class="skolem">Q</span><span class="main">)</span>"</span></span>	      
	      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
		<span class="keyword1"><span class="command">using</span></span> singleton_in_finpow union_finpow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
		<span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
		<span class="keyword1"><span class="command">using</span></span> bisect_fin bisec_is_pair Bisections_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
		<span class="keyword1"><span class="command">using</span></span> a_is_fun setprod_type <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span><span class="main">-</span><span class="skolem">A</span>›</span></span>
	      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"refl<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span> 
		<span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span>
		<span class="keyword1"><span class="command">using</span></span> linord IsLinOrder_def total_is_refl Bisections_def
		FinPow_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹refl<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> II 
	      <span class="keyword1"><span class="command">have</span></span> III<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl_add_point<span class="main">)</span>
	      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹refl<span class="main">(</span><span class="free">X</span><span class="main">,</span><span class="free">r</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⊆</span> <span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> II 
	      <span class="keyword1"><span class="command">have</span></span>  IV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="skolem">n</span><span class="main">⟩</span> <span class="main">∈</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> refl_add_point<span class="main">)</span>
	      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
		<span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∨</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∨</span> <span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">-</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">⟩</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span>
		<span class="keyword1"><span class="command">using</span></span> bisec_is_pair bisec_add_point <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	      <span class="keyword1"><span class="command">moreover</span></span>
	      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
		<span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">moreover</span></span> 
		<span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>›</span></span> 
		<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">⟩</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> bisec_is_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
		<span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">⟩</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
		<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> 
		  <span class="keyword1"><span class="command">using</span></span> set_point_bisec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> II <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span> 
		<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> a_is_fun gen_prod_append gen_prod_singleton 
		  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
	      <span class="keyword1"><span class="command">moreover</span></span>
	      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>"</span></span>
		<span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> singleton_in_finpow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∉</span> <span class="skolem">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">moreover</span></span> 
		<span class="keyword1"><span class="command">from</span></span>  <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>›</span></span>
		<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> bisec_is_pair <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
		<span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
		<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="skolem">A</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> point_set_bisec
		  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">with</span></span> A1 <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> II
		  <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span>  <span class="quoted"><span class="quoted">‹<span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span>›</span></span>
		<span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> a_is_fun gen_prod_append gen_prod_singleton 
		    setprod_type IsCommutative_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
	      <span class="keyword1"><span class="command">moreover</span></span>
	      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">⟩</span> <span class="main">∈</span>  Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span>
		<span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
		  <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
		  <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> FinPow_def Bisections_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
		  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>
		  T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="skolem">n</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
		  <span class="keyword1"><span class="command">using</span></span> a_is_fun setprod_type apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Q</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">)</span>›</span></span> A4 <span class="keyword1"><span class="command">have</span></span>
		  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">⟩</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">∨</span> 
		  <span class="main">(</span><span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">)</span> "</span></span>
		  <span class="keyword1"><span class="command">using</span></span> bisec_is_pair bisec_add_point_case3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
		<span class="keyword1"><span class="command">moreover</span></span>
		<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">⟩</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
		  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bisec_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
		  <span class="keyword1"><span class="command">with</span></span> A2 <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> I II T IV
		    <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">⟩</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> 
		    <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> 
		    <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span> <span class="main">≠</span> <span class="main">0</span>›</span></span>
		  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
		    <span class="keyword1"><span class="command">using</span></span> gen_prod_append semigr_assoc gen_product_rem_point 
		    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
		<span class="keyword1"><span class="command">moreover</span></span>
		<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
		  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bisec_props <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
		  <span class="keyword1"><span class="command">with</span></span> A1 A2 <span class="quoted"><span class="quoted">‹<span class="skolem">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="free">X</span> <span class="main">-</span> <span class="skolem">A</span>›</span></span> I II III T 
		    <span class="quoted"><span class="quoted">‹<span class="main">⟨</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span> <span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">⟩</span><span class="main">∈</span>Bisections<span class="main">(</span><span class="skolem">A</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">-</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">∈</span><span class="free">G</span>›</span></span> 
		    <span class="quoted"><span class="quoted">‹<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">n</span> <span class="main">∈</span> <span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">-</span><span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">≠</span><span class="main">0</span>›</span></span>
		  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
		    <span class="keyword1"><span class="command">using</span></span> gen_prod_append rearr3elems gen_product_rem_point 
		      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">}</span></span>
		<span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span>
		  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
		  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">}</span></span>
	      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">A</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">n</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>0</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?Q<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
		<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>	
	    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">qed</span></span>
	<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> A2
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> fin_ind_add_max<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A better looking reformulation of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_bisect›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> prod_disjoint<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∩</span> <span class="free">B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">B</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A2 A3 A4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">A</span><span class="main">,</span><span class="free">B</span><span class="main">⟩</span> <span class="main">∈</span> Bisections<span class="main">(</span><span class="free">A</span><span class="main">∪</span><span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_bisec <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> A1 A2 A3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">using</span></span> a_is_fun union_finpow prod_bisect <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A generalization of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_disjoint›</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> prod_list_of_lists<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
  A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
  <span class="bound">M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span> <span class="main">⟶</span> 
  <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="free">n</span><span class="main">)</span><span class="main">.</span> <span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">note</span></span> A2
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
    <span class="bound">M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="main">0</span><span class="main">)</span><span class="main">.</span> <span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> a_is_fun func1_1_L1 Partition_def apply_funtype setprod_type
      list_len1_singleton prod_of_1elem 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> nat<span class="main">.</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
    <span class="bound">M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>
    <span class="main">(</span><span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
    <span class="bound">M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span> <span class="main">⟶</span> 
    <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
    <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">k</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> nat"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">M</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
	<span class="bound">M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span> <span class="main">⟶</span> 
	<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
	<span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="bound">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">N</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span><span class="main">.</span> 
	<span class="bound">N</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span> <span class="main">⟶</span> 
	<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="bound">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
	<span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
	<span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">N</span> <span class="keyword3"><span class="command">assume</span></span> A4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
	  <span class="keyword3"><span class="command">assume</span></span> A5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span>"</span></span>
	  <span class="keyword1"><span class="command">with</span></span> A4 <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
	    <span class="keyword1"><span class="command">using</span></span> func1_1_L1 Partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?b</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
	  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?c</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">}</span>"</span></span>
	  <span class="keyword1"><span class="command">have</span></span> II<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span>
	  <span class="keyword1"><span class="command">proof</span></span> 
	    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">with</span></span> A4 I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
	      <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> setprod_type
	      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">qed</span></span>
	  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span>  <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">∈</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?c</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ZF_fun_from_total<span class="main">)</span>
	  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
	    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">with</span></span> II <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?b</span> <span class="main">=</span> Append<span class="main">(</span><span class="var">?c</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> set_list_append<span class="main">)</span>
	  <span class="keyword1"><span class="command">with</span></span>  II  <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?c</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> <span class="free">G</span>›</span></span> 
	  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="var">?c</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">using</span></span> prod_append <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
	    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
	    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"restrict<span class="main">(</span><span class="skolem">N</span><span class="main">,</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">⊆</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">:</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span>
	    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	      III<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">using</span></span> restrict_type2 restrict apply_funtype 
	      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">with</span></span> A5 <span class="quoted"><span class="quoted">‹<span class="var">?M</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span><span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span>"</span></span>
	      <span class="keyword1"><span class="command">using</span></span> func1_1_L1 Partition_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	    <span class="keyword1"><span class="command">with</span></span> A3 <span class="quoted"><span class="quoted">‹<span class="var">?M</span> <span class="main">:</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
	      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
	      <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
	    <span class="keyword1"><span class="command">with</span></span> III <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">qed</span></span>
	  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
	    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?A</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?B</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">from</span></span> A4 <span class="quoted"><span class="quoted">‹<span class="skolem">k</span> <span class="main">∈</span> nat›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
	      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> union_fin_list_fin<span class="main">)</span>
	    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> I <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A4 I <span class="keyword1"><span class="command">have</span></span> 
	      <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">N</span><span class="main">`</span><span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
	      <span class="keyword1"><span class="command">using</span></span> apply_funtype <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">∈</span> nat›</span></span> A4 A5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∩</span> <span class="var">?B</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
	      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> list_partition<span class="main">)</span>
	    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span> A1
	    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?A</span><span class="main">∪</span><span class="var">?B</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">⋅</span></span><span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?B</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">using</span></span> prod_disjoint <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">∪</span> <span class="var">?B</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">)</span>"</span></span>
	      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">qed</span></span>
	  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> 
	    <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> succ<span class="main">(</span>succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="skolem">N</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
	    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
	  <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
	<span class="keyword1"><span class="command">qed</span></span>
	<span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ind_on_nat<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A more convenient reformulation of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_list_of_lists›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> prod_list_of_sets<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> 
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">∈</span> nat"</span></span>  <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="main">:</span> <span class="free">n</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="free">M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="free">n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="free">n</span><span class="main">.</span> <span class="free">M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> succ<span class="main">(</span><span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Nat_ZF_1_L3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> A1 A3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> prod_list_of_lists
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The definition of the product 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>\&lt;pr&gt;(A,a) ≡ SetFold(f,a,A,r)›</span></span></span></span> of a some (finite) set of 
  semigroup elements requires that $r$ is a linear order on the set 
  of indices $A$. This is necessary so that we know in which order
  we are multiplying the elements. The product over $A$ is defined 
  so that we have $\prod_A a = \prod a \circ \sigma(A)$ where
  $\sigma : |A| \rightarrow A$ is the enumeration of $A$ (the only
  order isomorphism between the number of elements in $A$ and $A$), see
  lemma <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>setproddef›</span></span></span></span>.
  However, if the operation is commutative, the order is irrelevant. 
  The next theorem formalizes that fact stating that we can replace
  the enumeration $\sigma (A)$ by any bijection between $|A|$ and $A$.
  In a way this is a generalization of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>setproddef›</span></span></span></span>. 
  The proof is based on application of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>prod_list_of_sets›</span></span></span></span>
  to the finite collection of singletons that comprise $A$.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> prod_order_irr<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> bij<span class="main">(</span><span class="main">|</span><span class="free">A</span><span class="main">|</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">|</span><span class="free">A</span><span class="main">|</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?M</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">k</span><span class="main">,</span> <span class="main">{</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">}</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">k</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">.</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?n</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> A2 A3 <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> 
	<span class="keyword1"><span class="command">using</span></span> bij_def inj_def apply_funtype FinPow_def
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">`</span><span class="main">(</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span><span class="main">)</span>"</span></span> 
	<span class="keyword1"><span class="command">using</span></span> gen_prod_singleton <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> A3 <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?n</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">{</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span><span class="main">}</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> bij_def inj_def comp_fun_apply <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">i</span> <span class="main">∈</span> <span class="var">?n</span>›</span></span> A3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="skolem">i</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> bij_def inj_partition <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> <span class="var">?n</span> <span class="main">→</span> <span class="free">A</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_def inj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> FinPow_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">:</span> <span class="var">?n</span> <span class="main">→</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> func1_1_L1B<span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">:</span> <span class="var">?n</span> <span class="main">→</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a_is_fun comp_fun
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span> <span class="main">=</span> <span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> fun_is_set_of_pairs <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">.</span> <span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">note</span></span> A1
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">∈</span> nat"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?n</span> <span class="main">≠</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> card_fin_is_nat card_non_empty_non_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">:</span> <span class="var">?n</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> A2 A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">k</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">.</span> <span class="main">{</span><span class="free">b</span><span class="main">`</span><span class="main">(</span><span class="bound">k</span><span class="main">)</span><span class="main">}</span> <span class="main">∈</span>  FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span>
	<span class="keyword1"><span class="command">using</span></span> bij_def inj_def apply_funtype FinPow_def
	  singleton_in_finpow <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="main">:</span> <span class="var">?n</span> <span class="main">→</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ZF_fun_from_total
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> A3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?M</span> <span class="keyword1">{is</span> <span class="keyword1">partition}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bij_def inj_partition
	<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">{</span><span class="main">⟨</span><span class="bound">i</span><span class="main">,</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">⟩</span><span class="main">.</span> <span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">.</span> <span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> prod_list_of_sets<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">from</span></span> A3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="main">⋃</span><span class="bound">i</span> <span class="main">∈</span> <span class="var">?n</span><span class="main">.</span> <span class="var">?M</span><span class="main">`</span><span class="main">(</span><span class="bound">i</span><span class="main">)</span><span class="main">,</span><span class="free">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main"><span class="free">\&lt;pr&gt;</span></span><span class="main">(</span><span class="free">A</span><span class="main">,</span><span class="free">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bij_def inj_partition surj_singleton_image
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Another way of expressing the fact that the product dos not depend
  on the order.›</span></span>

<span class="keyword1"><span class="command">corollary</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> semigr1<span class="main">)</span> prod_bij_same<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="keyword1">{is</span> <span class="keyword1">commutative</span> <span class="keyword1">on}</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">∈</span> FinPow<span class="main">(</span><span class="free">X</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">≠</span> <span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">∈</span> bij<span class="main">(</span><span class="main">|</span><span class="free">A</span><span class="main">|</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∈</span> bij<span class="main">(</span><span class="main">|</span><span class="free">A</span><span class="main">|</span><span class="main">,</span><span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main"><span class="free">∏</span></span> <span class="main">(</span><span class="free">a</span> <span class="keyword1">O</span> <span class="free">c</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms prod_order_irr <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</body>

</html>